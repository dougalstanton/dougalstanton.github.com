
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Home-brew static analysis for fun and profit - Looking Out To Sea</title>
  <meta name="author" content="Dougal Stanton">

  
  <meta name="description" content="I&#8217;ve had recent success with writing test tools for use in-house. We have a system which greatly abuses the C preprocessor to create (at build- &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dougalstanton.github.com/blog/2013/02/19/home-brew-static-analysis/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Looking Out To Sea" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Looking Out To Sea</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dougalstanton.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Home-brew Static Analysis for Fun and Profit</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-19T22:28:00+00:00" pubdate data-updated="true">Tuesday, 19 February 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&#8217;ve had recent success with writing test tools for use in-house. We have a system which greatly abuses the C preprocessor to create (at build-time) sets of translations and default settings for different languages and particular customers.</p>

<p>Due to the limitations of anything built with the preprocessor there isn&#8217;t anything even remotely like type checking. In order to truly spot any problems in the translations you have to build the binary (and potentially even <em>run</em> it). Which means we need a single binary which includes every single customer variant and linguistic complexity, which will take an age to build; or we have to build have a dozen variants to ensure that adding one thing doesn&#8217;t cause mayhem.</p>

<p>And as mentioned, building it doesn&#8217;t really go all the way. If the possible values for a timer are between 5 and 300 there&#8217;s no way the compiler can spot that 405 or 2 are invalid. All it can check is that the <code>int</code> you&#8217;ve provided will happily compile when inserted into an array of <code>int</code>.</p>

<p>Thankfully most of these checks can be done easily and quickly &#8212; very quickly &#8212; without even compiling. The unprocessed file has some hints to translators to indicate what are valid sizes for strings, ranges for numbers and descriptions of the text. Parsing this meta-data alongside the translations gives us all the information we need to perform these checks without compiling anything.</p>

<p>Once the necessary data is parsed and the remainder discarded we can get to the interesting work. Thankfully I started this work during a period of intense development on menu strings and default options, so the translation file was suffering a lot of abuse. Finding candidate tests was as easy as looking at the most recent reasons for fixing the file.</p>

<p>Initially I ran all tests in parallel, gathering results as they went and discarding the used data. (A single pass is definitely beneficial when you&#8217;ve just loaded in ~100,000 lines.) This was considerably faster than running one pass for each test. The result was printed to standard out almost instantly, which was gratifying when it passed and even better when it spotted a legitimate failure.</p>

<p>But I was tempted by the option in the Jenkins CI server to pick up JUnit-style XML files and create comparison graphs of successive runs. I could have graphs of my successful tests, for free! All I would have to do is write some XML in an undocumented format, which no longer felt so appealing.</p>

<p>Thankfully a test runner called Test Framework came to the rescue, promising to write the XML for me. I converted the format and results of my tests into some structure it could understand and let it do the hard work. I got prettier command line output and XML files that Jenkins could parse, but lost one-pass testing. I can live with this; the tests still run in about six seconds which is a considerable saving on a twenty minute build.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dougal Stanton</span></span>

      








  


<time datetime="2013-02-19T22:28:00+00:00" pubdate data-updated="true">Tuesday, 19 February 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/haskell/'>haskell</a>, <a class='category' href='/blog/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://dougalstanton.github.com/blog/2013/02/19/home-brew-static-analysis/" data-via="" data-counturl="http://dougalstanton.github.com/blog/2013/02/19/home-brew-static-analysis/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/02/18/five-minutes-everyday/" title="Previous Post: Five minutes everyday to turn the world upside down">&laquo; Five minutes everyday to turn the world upside down</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/02/22/non-conformant-markdown-processor/" title="Next Post: Octopress uses a non-conformant Markdown processor as standard">Octopress uses a non-conformant Markdown processor as standard &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/02/22/non-conformant-markdown-processor/">Octopress uses a non-conformant Markdown processor as standard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/19/home-brew-static-analysis/">Home-brew static analysis for fun and profit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/18/five-minutes-everyday/">Five minutes everyday to turn the world upside down</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/17/salvaging-the-challenge/">Salvaging the Challenge</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/11/migration-to-octopress-etc/">Migration to Octopress etc</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Dougal Stanton -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
